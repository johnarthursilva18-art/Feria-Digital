<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feria Digital</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2E7D32">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/862/862856.png">
    
    <style>
        :root { --primary: #2E7D32; --bg: #e0e0e0; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            background: var(--bg); 
            display: flex;
            justify-content: center; /* Centrar en PC */
            min-height: 100vh;
        }

        /* Esto crea la forma de celular en PC */
        .mobile-wrapper {
            width: 100%;
            max-width: 450px; /* Ancho m√°ximo limitado */
            background: #ffffff;
            min-height: 100vh;
            box-shadow: 0 0 25px rgba(0,0,0,0.15);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        header { 
            background: var(--primary); 
            color: white; 
            padding: 15px; 
            text-align: center; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }

        h1 { margin: 0; font-size: 1.2rem; }
        
        .container { 
            padding: 15px; 
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-bottom: 50px;
        }
        
        .card { 
            background: white; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.08); 
            border: 1px solid #f0f0f0;
        }

        .card-img { width: 100%; height: 220px; object-fit: cover; background: #eee; }
        .card-body { padding: 15px; }
        
        .price { color: var(--primary); font-weight: 800; font-size: 1.4rem; margin-bottom: 5px; }
        .product { font-weight: 600; font-size: 1.1rem; color: #222; margin-bottom: 5px; line-height: 1.3; }
        .farmer { font-size: 0.9rem; color: #666; margin-bottom: 15px; display: flex; align-items: center; gap: 5px; }
        
        .btn { background: #25D366; color: white; text-decoration: none; padding: 14px; border-radius: 10px; text-align: center; font-weight: bold; display: block; width: 100%; font-size: 1rem; box-shadow: 0 4px 6px rgba(37, 211, 102, 0.2); }
        .btn:active { transform: scale(0.98); }

        .loading { text-align: center; padding: 40px; color: #888; margin-top: 50px; }
    </style>
</head>
<body>

<div class="mobile-wrapper">
    <header>
        <h1>ü•¶ Feria Digital Viernes</h1>
    </header>

    <div class="container" id="app">
        <div class="loading">Cargando la feria... ‚è≥</div>
    </div>
</div>

<script>
    // --- ‚¨áÔ∏è PEGA TU ENLACE CSV AQU√ç (NO OLVIDES ESTO) ‚¨áÔ∏è ---
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRoqVSEYMGwKzeTQalBvL7CkTxp-4TC43rjI1iUaAu1bwpSByacXeHR62rM86Rv_na4L_Z8tRX7Mr0w/pub?output=csv"; 
    // -------------------------------------------------------

    async function init() {
        try {
            const response = await fetch(SHEET_URL);
            const data = await response.text();
            const rows = csvToJSON(data);
            render(rows);
        } catch (e) {
            console.error(e);
            document.getElementById('app').innerHTML = '<div style="text-align:center; padding:40px">‚ö†Ô∏è<br>Error cargando datos.<br>Verifica el enlace CSV.</div>';
        }
    }

    function csvToJSON(csv) {
        const lines = csv.split("\n");
        const result = [];
        const headers = lines[0].split(",").map(h => h.trim().replace(/"/g, ''));
        
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i]) continue;
            const matches = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            if (!matches) continue;

            const obj = {};
            headers.forEach((header, j) => {
                let val = matches[j] ? matches[j].replace(/"/g, '').trim() : "";
                obj[header] = val;
            });
            result.push(obj);
        }
        return result;
    }

    function render(products) {
        const app = document.getElementById('app');
        app.innerHTML = ''; 

        if(products.length === 0) {
            app.innerHTML = '<p style="text-align:center; padding:20px">No hay productos.</p>';
            return;
        }

        products.forEach(p => {
            if(!p.Producto) return; 
            
            const card = document.createElement('div');
            card.className = 'card';
            
            const msg = `Hola ${p.Agricultor}, vi su *${p.Producto}* en la Feria Digital y quiero comprar.`;
            const waLink = `https://wa.me/51${p.Telefono}?text=${encodeURIComponent(msg)}`;
            const imgUrl = p.Foto && p.Foto.length > 5 ? p.Foto : 'https://via.placeholder.com/400x300?text=Foto+Referencial';

            card.innerHTML = `
                <img src="${imgUrl}" class="card-img" alt="${p.Producto}" onerror="this.src='https://via.placeholder.com/400x300?text=Sin+Foto'">
                <div class="card-body">
                    <div class="product">${p.Producto}</div>
                    <div class="price">${p.Precio}</div>
                    <div class="farmer">üë®‚Äçüåæ ${p.Agricultor}</div>
                    <a href="${waLink}" class="btn" target="_blank">üü¢ Pedir por WhatsApp</a>
                </div>
            `;
            app.appendChild(card);
        });
    }
    
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
    init();
</script>
</body>
</html>
